# supervisor.conf (Versión 3.2 - Log Rotation)
# Fecha de Actualización: 27 de Septiembre, 2025

[supervisord]
nodaemon=false
logfile=/workspace/logs/supervisord.log
pidfile=/var/run/supervisord.pid

[unix_http_server]
file=/var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[program:worker_server]
command=/usr/bin/python3.11 -m uvicorn worker_server:app --host 0.0.0.0 --port 8188 --proxy-headers
directory=/workspace
environment=HF_HOME="/workspace/huggingface_cache"
autostart=true
autorestart=true
stdout_logfile=/workspace/logs/worker_server.log
stderr_logfile=/workspace/logs/worker_server_errors.log
# --- [CORRECCIÓN: ROTACIÓN DE LOGS] ---
logfile_maxbytes=50MB
logfile_backups=5

[program:file_server]
command=/usr/bin/python3.11 -m gunicorn --workers 4 --bind 0.0.0.0:8000 --chdir /workspace --forwarded-allow-ips="*" file_server:app
directory=/workspace
autostart=true
autorestart=true
stdout_logfile=/workspace/logs/file_server.log
stderr_logfile=/workspace/logs/file_server_errors.log
# --- [CORRECCIÓN: ROTACIÓN DE LOGS] ---
logfile_maxbytes=50MB
logfile_backups=5

[program:comfyui]
command=python main.py --listen 0.0.0.0 --port 8189
directory=/workspace/ComfyUI
autostart=true
autorestart=true
stdout_logfile=/workspace/logs/comfyui.log
stderr_logfile=/workspace/logs/comfyui_errors.log
# --- [CORRECCIÓN: ROTACIÓN DE LOGS] ---
logfile_maxbytes=50MB
logfile_backups=5
